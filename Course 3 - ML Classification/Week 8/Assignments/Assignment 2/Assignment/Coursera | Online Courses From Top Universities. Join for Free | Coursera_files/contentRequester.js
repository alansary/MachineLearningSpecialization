define("pages/open-course/common/contentRequester",["require","exports","module","q","js/lib/user","js/lib/path","jsuri","pages/open-course/common/api","memoize!pages/open-course/common/promises/courseGrade","memoize!pages/open-course/common/promises/courseProgress"],function(require,exports,module){"use strict";var t=require("q"),s=require("js/lib/user"),e=require("js/lib/path"),o=require("jsuri"),a=require("pages/open-course/common/api"),i=require("memoize!pages/open-course/common/promises/courseGrade"),n=require("memoize!pages/open-course/common/promises/courseProgress"),u=function apiUrl(e){var r={closedPeer:"peer",gradedPeer:"peer",phasedPeer:"peer",splitPeerReviewItem:"peer"};return r[e]||e},m=function buildBaseUrl(){return e.join("user",s.get().id,"course",this.itemMetadata.get("course").get("slug"),"item",this.itemMetadata.getId(),u(this.itemMetadata.getTypeName()))},r=function ContentRequester(e){this.itemMetadata=e};r.prototype.request=function(s,c){var r=this.itemMetadata,p=m.call(this),u=new o(e.join(p,s));/action/.test(s)&&u.addQueryParam("autoEnroll","false");var d={data:{contentRequestBody:c}};return t.allSettled([i(r.get("course").get("id")),n(r.get("course").get("slug")),a.post(u.toString(),d)]).spread(function(n,u,t){if("rejected"===t.state)throw t.reason;var m=u.value,s=n.value,e=t.value,o=r.getId(),a=m.getItemProgress(o);a&&e&&e.itemProgress&&a.set(e.itemProgress,{refreshCourseProgress:!0});var i=s.getItemGrade(o);return i&&e&&e.itemGradeRecord&&(i.set(e.itemGradeRecord),s.refresh()),e&&e.contentResponseBody})},module.exports=r});