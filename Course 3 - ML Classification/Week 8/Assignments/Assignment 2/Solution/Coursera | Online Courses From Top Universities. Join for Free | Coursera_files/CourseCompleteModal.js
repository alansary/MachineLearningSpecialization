define("bundles/item/components/CourseCompleteModal",["require","exports","module","underscore","react","bundles/ssr/stores/ApplicationStore","bundles/ondemand/stores/CourseStore","bundles/ondemand/stores/CourseViewGradeStore","bundles/ondemand/stores/VerificationStore","bundles/ondemand/stores/S12nStore","bundles/ondemand/actions/VerificationActions","bundles/ondemand/actions/CourseViewGradeActions","bundles/ondemand/actions/S12nActions","bundles/phoenix/components/Modal","bundles/item/components/EndOfCourseHeader","bundles/item/components/KeepLearning","bundles/item/utils/endOfCourseUtils","bundles/phoenix/lib/waitForStores","js/lib/provideFluxibleAppContext","js/lib/setupFluxibleApp","bundles/ondemand/models/S12n","pages/open-course/common/models/courseProgress","i18n!nls/item","css!./__styles__/CourseCompleteModal"],function(require,exports,module){"use strict";function _defaults(e,t){for(var n=Object.getOwnPropertyNames(t),o=0;o<n.length;o++){var s=n[o],r=Object.getOwnPropertyDescriptor(t,s);r&&r.configurable&&void 0===e[s]&&Object.defineProperty(e,s,r)}return e}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?o:e}function _inherits(o,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):_defaults(o,e))}var o,s,r,u=require("underscore"),d=u.compose,e=require("react"),a=require("bundles/ssr/stores/ApplicationStore"),c=require("bundles/ondemand/stores/CourseStore"),l=require("bundles/ondemand/stores/CourseViewGradeStore"),p=require("bundles/ondemand/stores/VerificationStore"),m=require("bundles/ondemand/stores/S12nStore"),b=require("bundles/ondemand/actions/VerificationActions"),i=b.loadVerificationDisplay,f=require("bundles/ondemand/actions/CourseViewGradeActions"),t=f.refreshCourseViewGrade,h=require("bundles/ondemand/actions/S12nActions"),C=h.loadS12n,S=require("bundles/phoenix/components/Modal"),g=require("bundles/item/components/EndOfCourseHeader"),y=require("bundles/item/components/KeepLearning"),n=require("bundles/item/utils/endOfCourseUtils"),P=require("bundles/phoenix/lib/waitForStores"),w=require("js/lib/provideFluxibleAppContext"),x=require("js/lib/setupFluxibleApp"),A=require("bundles/ondemand/models/S12n"),I=require("pages/open-course/common/models/courseProgress"),v=require("i18n!nls/item");require("css!./__styles__/CourseCompleteModal");var O=(s=o=function(o){function CourseCompleteModal(e,s){_classCallCheck(this,CourseCompleteModal);var n=_possibleConstructorReturn(this,o.call(this,e,s));r.call(n);var a=e.authenticated,l=e.course,u=e.courseId,d=e.userId,c=e.s12n,p=c&&c.getId(),m=l.isVerificationEnabled();return s.executeAction(i,{authenticated:a,userId:d,courseId:u,isCourseVerificationEnabled:m,s12nId:p}),s.executeAction(C,{authenticated:a,courseId:u,userId:d}),s.executeAction(t,{userId:d,courseId:u}),e.courseProgress&&e.courseProgress.on("refreshed",n.onCourseProgressRefresh),n}return _inherits(CourseCompleteModal,o),CourseCompleteModal.prototype.componentWillUnmount=function componentWillUnmount(){this.props.courseProgress&&this.props.courseProgress.off("refreshed",this.onCourseProgressRefresh)},CourseCompleteModal.prototype.shouldDisplayModal=function shouldDisplayModal(){var e=this.props,o=e.courseId,s=e.passedCourse;return s&&!n.hasDismissedCourseCompleteModal(o)&&!this.state.modalClosed},CourseCompleteModal.prototype.render=function render(){return this.shouldDisplayModal()?e.createElement(S,{modalName:v("Course complete"),className:"rc-CourseCompleteModal theme-light",handleClose:this.closeModal,trackingName:"course_complete_modal",allowClose:!0},e.createElement(g,{showPartner:!0}),e.createElement("div",{className:"content"},e.createElement(y,{showS12nProgress:!0}))):null},CourseCompleteModal}(e.Component),o.propTypes={passedCourse:e.PropTypes.bool,courseProgress:e.PropTypes.instanceOf(I),courseId:e.PropTypes.string,userId:e.PropTypes.number,authenticated:e.PropTypes.bool,course:e.PropTypes.object,s12n:e.PropTypes.instanceOf(A)},o.contextTypes={executeAction:e.PropTypes.func.isRequired},r=function _initialiseProps(){var e=this;this.state={modalClosed:!1},this.onCourseProgressRefresh=function(){var o=e.props.courseId;e.context.executeAction(t,{courseId:o})},this.closeModal=function(){e.setState({modalClosed:!0}),n.dismissCourseCompleteModal(e.props.courseId)}},s);module.exports=d(w(function(e){return x(e,function(o){return o.registerStore(a),o.registerStore(c),o.registerStore(l),o.registerStore(p),o.registerStore(m),e})}),P(["ApplicationStore","CourseStore","CourseViewGradeStore","S12nStore"],function(e,n){var o=e.ApplicationStore,s=e.CourseStore,r=e.CourseViewGradeStore,t=e.S12nStore;return{userId:o.getUserData().id,courseId:s.getCourseId(),course:s.getMetadata(),s12n:t.getS12n(),authenticated:o.isAuthenticatedUser(),passedCourse:!!r.hasPassedCourseUnverified()}}))(O)});