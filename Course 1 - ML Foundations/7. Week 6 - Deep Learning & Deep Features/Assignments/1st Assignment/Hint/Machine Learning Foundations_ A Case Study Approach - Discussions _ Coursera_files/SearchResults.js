define("bundles/discussions/components/search/SearchResults",["require","exports","module","underscore","react","bundles/discussions/constants","bundles/discussions/actions/DiscussionsSearchActions","bundles/discussions/components/ListBody","bundles/discussions/components/search/SearchBar","bundles/discussions/components/search/SearchResultEntry","bundles/page/components/PaginationControls","js/lib/path","js/lib/connectToRouter","vendor/cnpm/fluxible.v0-4/addons/connectToStores","js/lib/waitFor","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/routerConnectToCurrentForum","bundles/naptimejs/resources/onDemandCourseForums.v1","bundles/naptimejs/resources/onDemandMentorForums.v1","bundles/naptimejs/resources/groupForums.v1","bundles/discussions/components/discussionsForumsHOC","js/lib/coursera.react-intl","i18n!nls/discussions","css!./__styles__/SearchResults","css!bundles/page/components/__styles__/PaginationControls.css"],function(require,exports,module){"use strict";function _defaults(e,n){for(var o=Object.getOwnPropertyNames(n),s=0;s<o.length;s++){var t=o[s],r=Object.getOwnPropertyDescriptor(n,t);r&&r.configurable&&void 0===e[t]&&Object.defineProperty(e,t,r)}return e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?s:e}function _inherits(s,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):_defaults(s,e))}var t,o,y=require("underscore"),F=y.compose,e=require("react"),c=require("bundles/discussions/constants"),r=c.loadingStates,n=require("bundles/discussions/actions/DiscussionsSearchActions"),l=require("bundles/discussions/components/ListBody"),p=require("bundles/discussions/components/search/SearchBar"),m=require("bundles/discussions/components/search/SearchResultEntry"),i=require("bundles/page/components/PaginationControls"),d=require("js/lib/path"),u=require("js/lib/connectToRouter"),h=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),g=require("js/lib/waitFor"),f=require("bundles/discussions/utils/discussionsUrl"),b=f.getAllThreadsDiscussionsUrl,S=require("bundles/discussions/utils/routerConnectToCurrentForum"),q=require("bundles/naptimejs/resources/onDemandCourseForums.v1"),P=require("bundles/naptimejs/resources/onDemandMentorForums.v1"),T=require("bundles/naptimejs/resources/groupForums.v1"),v=require("bundles/discussions/components/discussionsForumsHOC"),x=require("js/lib/coursera.react-intl"),a=x.FormattedMessage,s=require("i18n!nls/discussions");require("css!./__styles__/SearchResults"),require("css!bundles/page/components/__styles__/PaginationControls.css");var R=(o=t=function(t){function SearchResults(s,r){_classCallCheck(this,SearchResults);var e=_possibleConstructorReturn(this,t.call(this,s,r));return e.handleQueryChange=function(s){e.setState({query:s})},e.handleSearchCourse=function(s){s.preventDefault();var t=d.join(e.props.rootPath,"discussions/all");e.context.router.push({pathname:t,params:{},query:{q:e.state.query}})},e.onPageChange=function(s){e.context.router.push({pathname:e.context.router.location.pathname,params:{},query:Object.assign(e.context.router.location.query,{page:s})}),e.context.executeAction(n.goToPage,{query:e.props.query,pageNum:s,forumId:e.props.currentForum.forumId,contextId:e.props.contextId,forumType:e.props.currentForum.forumType.typeName,includeDeleted:e.props.hasModerationRole})},e.submitSearch=function(){if(e.state.query){var s=e.state.query.replace("*","");e.context.router.push({pathname:window.location.pathname,params:{},query:{q:s}})}},e.navigateBack=function(s){s.preventDefault(),e.context.router.push(e.props.currentForumUrl)},e.state={query:s.query||""},s.query&&e.context.executeAction(n.search,{query:s.query,filterQueryString:s.filterQueryString,pageNum:s.page,forumId:s.currentForum.forumId,contextId:s.contextId,forumType:s.currentForum.forumType.typeName,reset:!0,includeDeleted:s.hasModerationRole}),e}return _inherits(SearchResults,t),SearchResults.prototype.componentWillReceiveProps=function componentWillReceiveProps(e,s,t){(e.query!==this.props.query||e.pathname!==this.props.pathname||e.currentForum.id!==this.props.currentForum.id||e.filterQueryString!==this.props.filterQueryString)&&(this.setState({query:e.query}),this.context.executeAction(n.search,{query:e.query,filterQueryString:e.filterQueryString,pageNum:this.props.page,forumId:e.currentForum.forumId,contextId:e.contextId,forumType:e.currentForum.forumType.typeName,reset:this.props.filterQueryString!==e.filterQueryString,includeDeleted:e.hasModerationRole}))},SearchResults.prototype.render=function render(){var o=this,t=this.context.router.isActive({pathname:b()}),d=!!this.context.router.params.item_id,u=!t&&!d,n=this.props.currentForum.title,y=this.props.currentForumUrl,c=void 0,h=e.createElement("button",{onClick:this.handleSearchCourse,className:"nostyle search-course-link button-link"},s("Search All Discussions")),g=e.createElement("div",{className:"results-metadata bgcolor-black-g1"},e.createElement("span",{className:"color-secondary-text"},this.props.loadingState===r.DONE?e.createElement(a,{message:s("{numResults} search results in {displayName}"),numResults:this.props.numResults,displayName:n}):e.createElement(a,{message:s("Finding search results in {displayName}"),displayName:n}),u&&" â€¢ ",u&&h));return this.props.loadingState===r.DONE&&this.props.currentResults.length>0&&(c=this.props.currentResults.map(function(s,t){return e.createElement(m,{key:s.id,index:t,entry:s,page:o.props.page,query:o.props.query,forumLink:y})})),e.createElement("div",{className:"rc-DiscussionsSearchResults"},e.createElement("div",{className:"results-container card-rich-interaction"},!t&&e.createElement("div",{className:"bgcolor-black-g1"},e.createElement("button",{onClick:this.navigateBack,className:"nostyle back-area button-link"},e.createElement("div",{className:"back-arrow"},e.createElement("i",{className:"cif-arrow-left back-arrow-image"})),e.createElement("span",{className:"back-label body-2-text"},s("Back to "+n)))),!t&&e.createElement(p,{query:this.state.query,handleSubmit:this.submitSearch,handleChange:this.handleQueryChange}),!t&&g,e.createElement(l,{loadingState:this.props.loadingState},c)),e.createElement(i,{onPageChange:this.onPageChange,pageCount:this.props.pageCount,currentPage:this.props.page,maxPages:5}))},SearchResults}(e.Component),t.propTypes={currentForum:e.PropTypes.oneOfType([e.PropTypes.instanceOf(q),e.PropTypes.instanceOf(P),e.PropTypes.instanceOf(T)]),query:e.PropTypes.string.isRequired,pathname:e.PropTypes.string.isRequired,page:e.PropTypes.number.isRequired,loadingState:e.PropTypes.oneOf(Object.keys(r)),pageCount:e.PropTypes.number,currentResults:e.PropTypes.array,numResults:e.PropTypes.number,filterQueryString:e.PropTypes.string,rootPath:e.PropTypes.string,currentForumUrl:e.PropTypes.string,hasModerationRole:e.PropTypes.bool,contextId:e.PropTypes.string},t.contextTypes={executeAction:e.PropTypes.func.isRequired,router:e.PropTypes.object.isRequired},o);module.exports=F(u(function(e){return{query:decodeURIComponent(e.location.query.q),pathname:e.location.pathname}}),v({fields:["title","link","forumType"]}),u(S),h(["DiscussionsSearchStore","SessionFilterStore"],function(r,s){var e=r.DiscussionsSearchStore,n=r.SessionFilterStore,t=s.currentForum.forumId;return{filterQueryString:n.activeFilterQueryString,currentResults:e.searchResults({forumId:t,query:s.query,pageNum:e.currentPage}),loadingState:e.loadingState,pageCount:e.getPageCount({forumId:t,query:s.query}),numResults:e.getNumResults({forumId:t,query:s.query})}}),g(function(e){return e.currentForum}))(R)});