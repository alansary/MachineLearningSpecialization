define("bundles/discussions/components/discussionsBody/ThreadsList",["require","exports","module","react","underscore","bundles/discussions/actions/ThreadsActions","bundles/discussions/components/ControlsBar","bundles/discussions/components/ListBody","bundles/discussions/components/NewThreadButton","bundles/discussions/components/discussionsBody/ThreadsListEntry","bundles/discussions/constants","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/unreadTracker","bundles/page/components/PaginationControls","bundles/naptimejs/resources/onDemandCourseForums.v1","bundles/naptimejs/resources/onDemandMentorForums.v1","bundles/naptimejs/resources/groupForums.v1","js/lib/connectToRouter","bundles/discussions/utils/routerConnectToCurrentForum","bundles/discussions/components/discussionsForumsHOC","js/lib/waitFor","vendor/cnpm/fluxible.v0-4/addons/connectToStores","i18n!nls/discussions","css!bundles/discussions/components/discussionsBody/__styles__/ThreadsList","css!bundles/page/components/__styles__/PaginationControls.css"],function(require,exports,module){"use strict";function _defaults(e,r){for(var o=Object.getOwnPropertyNames(r),s=0;s<o.length;s++){var t=o[s],n=Object.getOwnPropertyDescriptor(r,t);n&&n.configurable&&void 0===e[t]&&Object.defineProperty(e,t,n)}return e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?s:e}function _inherits(s,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):_defaults(s,e))}var s,t,e=require("react"),T=require("underscore"),v=T.compose,O=require("bundles/discussions/actions/ThreadsActions"),n=O.loadThreads,c=require("bundles/discussions/components/ControlsBar"),d=require("bundles/discussions/components/ListBody"),p=require("bundles/discussions/components/NewThreadButton").NewThreadButtonNaptimeContainer,l=require("bundles/discussions/components/discussionsBody/ThreadsListEntry"),m=require("bundles/discussions/constants"),a=m.loadingStates,y=require("bundles/discussions/utils/discussionsUrl"),g=require("bundles/discussions/utils/discussionsUrl"),h=g.getAllThreadsDiscussionsUrl,f=require("bundles/discussions/utils/unreadTracker"),b=require("bundles/page/components/PaginationControls"),r=require("bundles/naptimejs/resources/onDemandCourseForums.v1"),o=require("bundles/naptimejs/resources/onDemandMentorForums.v1"),i=require("bundles/naptimejs/resources/groupForums.v1"),P=require("js/lib/connectToRouter"),S=require("bundles/discussions/utils/routerConnectToCurrentForum"),F=require("bundles/discussions/components/discussionsForumsHOC"),C=require("js/lib/waitFor"),w=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),u=require("i18n!nls/discussions");require("css!bundles/discussions/components/discussionsBody/__styles__/ThreadsList"),require("css!bundles/page/components/__styles__/PaginationControls.css");var x=(t=s=function(s){function ThreadsList(){var r,t,o;_classCallCheck(this,ThreadsList);for(var i=arguments.length,a=Array(i),n=0;i>n;n++)a[n]=arguments[n];return r=t=_possibleConstructorReturn(this,s.call.apply(s,[this].concat(a))),t.state={inSearch:!1},t.onPageChange=function(e){var s=t.context.router;s.push({pathname:t.context.router.location.pathname,params:{},query:Object.assign(t.context.router.location.query,{page:e})})},t.toggleSearch=function(){t.setState({inSearch:!t.state.inSearch})},t.renderEntry=function(s){var n=t.props,T=n.activeFilterQueryString,m=n.courseForums,p=n.mentorForums,c=n.groupForums,h=n.currentForum,d=n.currentForumUrl,i=s.lastAnsweredAt&&s.lastAnsweredBy,F=!f.hasUnread(s),g=i?s.lastAnsweredBy:s.creator,a=u(i?"Last post by":"Created by"),b=m.concat(p).concat(c),r=b.find(function(e){return e.forumId===s.forumId}),v=r&&h.id!==r.id&&r.title||void 0,P=y.getDeepLink(d,s),S="undefined"!=typeof s.answerCount&&!isNaN(s.answerCount),o=S?s.answerCount:s.totalAnswerCount;return e.createElement(l,{key:s.id+T,threadUrl:P,profile:g,timestamp:s.lastAnsweredAt||s.createdAt,threadName:s.content.question,questionId:s.id,questionUserId:s.creatorId,entry:s,isPinned:!(!s.state||!s.state.pinned),isDeleted:!(!s.state||!s.state.deleted),isRead:F,forumName:v,metadataLabel:a,viewCount:Math.max(o,s.viewCount),answerCount:o,badge:s.answerBadge.answerBadge})},o=r,_possibleConstructorReturn(t,o)}return _inherits(ThreadsList,s),ThreadsList.prototype.componentWillMount=function componentWillMount(){var e=this.props,t=e.sort,r=e.page,s=e.currentForum,o=e.activeFilterQueryString;this.context.executeAction(n,{filterQueryString:o,sort:t,pageNum:r,forumType:s&&s.forumType.typeName,forumId:s&&s.id,userId:this.props.userId,includeDeleted:this.props.hasModerationRole})},ThreadsList.prototype.componentWillUpdate=function componentWillUpdate(e,t,r){if(this.props.sort!==e.sort||this.props.page!==e.page||this.props.currentForumId!==e.currentForumId||this.props.activeFilterQueryString!==e.activeFilterQueryString){var s=this.props.currentForum;this.context.executeAction(n,{filterQueryString:e.activeFilterQueryString,sort:e.sort,pageNum:e.page,forumType:s&&s.forumType.typeName,forumId:s&&s.id,userId:this.props.userId,includeDeleted:this.props.hasModerationRole})}},ThreadsList.prototype.render=function render(){var s=this.context.router.isActive({pathname:h()});return e.createElement("div",{className:"rc-ThreadsList styleguide horizontal-box"},e.createElement("div",{className:"flex-2"},e.createElement("div",{className:"card-rich-interaction"},e.createElement(c,{sort:this.props.sort,inSearch:this.state.inSearch,toggleSearch:this.toggleSearch,showSearchBox:!s}),e.createElement(d,{emptyStatePlaceholderText:u("No Posts Yet"),fossilized:this.state.inSearch,loadingState:this.props.loadingState},this.props.entries&&this.props.entries.map(this.renderEntry))),e.createElement(b,{onPageChange:this.onPageChange,pageCount:this.props.pageCount,currentPage:this.props.page,maxPages:5})))},ThreadsList}(e.Component),s.propTypes={courseForums:e.PropTypes.arrayOf(e.PropTypes.instanceOf(r)),mentorForums:e.PropTypes.arrayOf(e.PropTypes.instanceOf(o)),groupForums:e.PropTypes.arrayOf(e.PropTypes.instanceOf(i)),currentForumId:e.PropTypes.string,currentForum:e.PropTypes.oneOfType([e.PropTypes.instanceOf(r),e.PropTypes.instanceOf(o),e.PropTypes.instanceOf(i)]),sort:e.PropTypes.string.isRequired,page:e.PropTypes.number.isRequired,entries:e.PropTypes.array,loadingState:e.PropTypes.oneOf(Object.keys(a)),pageCount:e.PropTypes.number,activeFilterQueryString:e.PropTypes.string,userId:e.PropTypes.number,hasModerationRole:e.PropTypes.bool,currentForumUrl:e.PropTypes.string},s.contextTypes={executeAction:e.PropTypes.func.isRequired,router:e.PropTypes.object.isRequired},t);module.exports=v(w(["SessionFilterStore","ThreadsStore","ApplicationStore"],function(e){var t=e.SessionFilterStore,s=e.ThreadsStore,n=e.ApplicationStore;return{activeFilterQueryString:t.activeFilterQueryString,entries:s.getThreadsPage(),loadingState:s.getLoadingState(),pageCount:s.getPageCount(),userId:n.getUserData().id}}),F({fields:["title","link","forumType"],subcomponents:[p]}),P(S),C(function(e){return!!(void 0!==e.activeFilterQueryString&&e.sort&&e.page&&e.currentForum)}))(x)});